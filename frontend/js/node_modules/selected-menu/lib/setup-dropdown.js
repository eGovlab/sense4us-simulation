'use strict';

function getDropdown(menuItem) {
    var dropdown = menuItem.addDropdown();
    var that     = this;
    dropdown.defaultValue(function() {
        if(!dropdown.changeProperty) {
            return '';
        }

        return dropdown.changeObject[dropdown.changeProperty];
    });

    dropdown.onChange(function() {
        var value = dropdown.getValue();

        dropdown.changeObject[dropdown.changeProperty] = value;

        that.emit('dataModified', dropdown.changeObject, dropdown.changeProperty, value);
        /*loadedModel.emit([value, dropdown.changeProperty, dropdown.changeObject], 'dataModified');
        loadedModel.emit('refresh');*/
    });

    return dropdown;
}

function setupDropdown(menuItem, row, item) {
    var dropdown = getDropdown.call(this, menuItem);

    dropdown.changeProperty = row.property;
    dropdown.changeObject   = item;

    dropdown.setLabel(row.property);
    dropdown.replaceValues(row.values);
    dropdown.refresh();

    if(row.showCondition && !row.showCondition(item)) {
        dropdown.hide();
    } else {
        dropdown.show();
    }

    return dropdown;
}

module.exports = setupDropdown;